# DG'hAck 2021 : PrettyVulnerability - 50 pts

## Énoncé 

>**Description**
>
>Un de mes amis a décidé de créer un portfolio en ligne afin d'appuyer sa candidature à la DGA. Je lui ai dit qu'une vulnérabilité est présente mais je ne suis pas allé plus loin sans son autorisation. Il ne me croit pas et me met au défi de trouver le champ `GECOS` de l'utilisateur `flag`. Apparemment il a également prévenu son hébergeur qui a pris des mesures pour empêcher l'exploitation de la vulnérabilité.

On a également le lien `https://web-yvqppk.inst.malicecyber.com/` vers un très joli portefolio codé en PHP.

## Analyse

L'énoncé est très clair sur ce qu'on doit chercher : le champ `GECOS` de l'utilisateur `flag`. Cette information peut être trouvée au sein du fichier `/etc/passwd`.

On commence par analyser le code source. On découvre une fonction `loadPage` qui permet le chargement des différents contenus du portfolio et qui vient modifier la variable `page?=` en appelant le fichier `loader.php`.

On tente d'appeler `loader.php` dans l'url : `https://web-yvqppk.inst.malicecyber.com/loader.php?page=/etc/passwd`

Mais la requête n'aboutit pas et nous renvoie un timeout... Très étrange... Peut-être une manière de filtrer les requêtes ?

Après plus de tests, on se rend compte que l'utilisation des caractères `/` et `..` entraîne un timeout, même en utilisant des encodages particuliers. Impossible d'accéder à notre fichier comme cela.

On commence donc par tenter du directory traversal à l'aveugle en utilisant directement la variable `page` : `https://web-yvqppk.inst.malicecyber.com/?page=/../../etc/passwd`

Là encore : timeout... Ce n'est pas bon signe.

On tente alors un autre payload : `https://web-yvqppk.inst.malicecyber.com/?page=/../../etc/hostname`

Cette fois, le serveur renvoie bien le hostname dans le contenu de la page ! On en conclut qu'il existe bien un filtre côté serveur. Après plus de recherche, on se rend compte que la combinaison `etc` et `passwd` sont bannis ensemble mais pas `/` ni `..` !

Ainsi, le payload `https://web-yvqppk.inst.malicecyber.com/?page=/../../etc/./passwd` est banni mais en encodant au moins un caractère dans l'url, ça marche !

Payload : `https://web-yvqppk.inst.malicecyber.com/?page=../../etc/%70asswd` où `%70` se convertit en `p`.

Le contenu du fichier `/etc/passwd` s'affiche alors sur la page et on peut récupérer le flag !

> Flag : DGHACK{F1sHc4n'tClImB4Tr33}
